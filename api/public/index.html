<!-- ===================== PART 1 / 7 ===================== -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#070812" />
  <title>PRO â€¢ COD Pricing Tool</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js + PDF libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg0:#070812;
      --bg1:#060713;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --stroke:rgba(255,255,255,.12);
      --glass:rgba(255,255,255,.06);
      --glass2:rgba(255,255,255,.10);
      --brand1:#8b5cf6;
      --brand2:#22d3ee;
      --brand3:#60a5fa;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow:0 24px 70px rgba(0,0,0,.45);
    }
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 70% 10%, rgba(139,92,246,.18), transparent 60%),
        radial-gradient(1000px 600px at 10% 35%, rgba(34,211,238,.14), transparent 55%),
        radial-gradient(900px 700px at 50% 100%, rgba(96,165,250,.12), transparent 60%),
        linear-gradient(180deg,var(--bg0),var(--bg1));
      font-family:Tajawal,Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow-x:hidden;
    }
    .glass{
      background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      backdrop-filter: blur(16px);
    }
    .glass-strong{
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.16);
      box-shadow:0 26px 90px rgba(0,0,0,.52);
      backdrop-filter: blur(18px);
    }
    .soft-border{position:relative}
    .soft-border:before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius:18px;
      padding:1px;
      background:linear-gradient(135deg, rgba(139,92,246,.55), rgba(34,211,238,.35), rgba(96,165,250,.45));
      -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
      opacity:.55;
      pointer-events:none;
    }
    .gradient-text{
      background:linear-gradient(135deg,var(--brand1),var(--brand2),var(--brand3));
      -webkit-background-clip:text;background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .premium-input{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      outline:none;
      transition:.18s ease;
    }
    .premium-input:focus{
      border-color:rgba(139,92,246,.65);
      box-shadow:0 0 0 4px rgba(139,92,246,.18);
      background:rgba(255,255,255,.08);
    }
    .btn{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.08);
      transition:.2s ease;
    }
    .btn:hover{background:rgba(255,255,255,.12);transform:translateY(-1px)}
    .btn.active{
      background:linear-gradient(135deg, rgba(139,92,246,.95), rgba(34,211,238,.45));
      border-color:rgba(139,92,246,.65);
      box-shadow:0 14px 45px rgba(139,92,246,.22);
    }
    .btn-gradient{
      border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(135deg, rgba(139,92,246,.92), rgba(34,211,238,.45));
      border-radius:16px;
      font-weight:900;
      transition:.25s ease;
    }
    .btn-gradient:hover{
      transform:translateY(-2px);
      box-shadow:0 30px 90px rgba(34,211,238,.18), 0 26px 80px rgba(139,92,246,.16);
    }
    .tab-button{
      border:1px solid transparent;
      color:rgba(255,255,255,.62);
      padding:10px 16px;
      border-radius:14px;
      transition:.2s ease;
      white-space:nowrap;
    }
    .tab-button:hover{
      color:rgba(255,255,255,.92);
      background:rgba(255,255,255,.06);
      border-color:rgba(255,255,255,.10);
    }
    .tab-button.active{
      color:rgba(255,255,255,.95);
      background:rgba(255,255,255,.10);
      border-color:rgba(139,92,246,.45);
      box-shadow:0 14px 45px rgba(139,92,246,.18);
    }
    .tab-content{display:none}
    .tab-content.active{display:block}
    .stat-card{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      padding:22px;
      transition:.25s ease;
      backdrop-filter: blur(12px);
    }
    .stat-card:hover{
      transform:translateY(-3px);
      border-color:rgba(139,92,246,.35);
      background:rgba(255,255,255,.08);
      box-shadow:0 22px 70px rgba(0,0,0,.35);
    }
    .chart-frame{
      border-radius:18px;
      overflow:hidden;
      background:linear-gradient(135deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 26px 90px rgba(0,0,0,.50);
    }
    .chart-inner{padding:14px}
    .chart-container{position:relative;height:320px}
    .no-print{}
    @media print{
      .no-print{display:none !important;}
      body{background:#fff !important;color:#000 !important;}
    }
    /* Scenario buttons */
    .scenario-btn{
      background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(14px);
      transition: .25s ease;
      box-shadow:
        0 18px 60px rgba(0,0,0,.25),
        0 0 0 1px rgba(255,255,255,.06),
        0 0 22px rgba(139,92,246,.14),
        0 0 18px rgba(34,211,238,.10);
    }
    .scenario-btn:hover{
      transform: translateY(-2px);
      border-color: rgba(139,92,246,.45);
      box-shadow:
        0 26px 90px rgba(0,0,0,.32),
        0 0 0 1px rgba(255,255,255,.08),
        0 0 34px rgba(139,92,246,.22),
        0 0 26px rgba(34,211,238,.16);
    }
    .scenario-btn:active{
      transform: translateY(0px);
    }

    /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø·ÙˆØ· ÙÙŠ ÙƒÙ„ Ø§Ù„Ø£Ø¯Ø§Ø© */
    body {
      font-size: 16px;
    }
    .premium-input, input, select {
      font-size: 16px !important;
    }
    label {
      font-size: 15px !important;
    }
    .stat-card {
      font-size: 16px;
    }
    h1, h2, h3, h4 {
      font-size: 1.1em !important;
    }
  </style>

  <!-- ===================== GOOGLE ANALYTICS 4 ===================== -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FLY2GHLT0X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FLY2GHLT0X');
  </script>
  <!-- ============================================================== -->

  <!-- ===================== FINAL VERSION - 24H WITH ANALYTICS ===================== -->
  <script>
    (function() {
      const TRIAL_DURATION = 24 * 60 * 60 * 1000; // 24 hours
      const WHATSAPP_NUMBER = "213540018556";
      const PRICE = "200,000 Ø¯Ø¬";

      const COOKIE_NAME = 'pricingToolFirstUse';
      const STORAGE_NAME = 'pricingToolStartTime';
      const LICENSE_STORAGE = 'pricingToolLicense';
      const VALID_LICENSE_KEYS = [
        'CODPRO-8X2K-9M4L-7N6P',
        'CODGLD-5Q3R-1W8T-4Y9Z',
        'CODULT-2A6B-3C8D-9E5F',
        'CODVIP-7H4J-6K2M-8N1L',
        'CODMAX-9P5Q-4R7S-2T8V'
      ];

      function validateLicenseKey(key) {
        if (!key || key.length < 10) return false;
        return VALID_LICENSE_KEYS.includes(key.toUpperCase().trim());
      }

      function activateLicense(key) {
        const licenseData = { key: key, activatedAt: Date.now() };
        localStorage.setItem(LICENSE_STORAGE, JSON.stringify(licenseData));
        setCookie(LICENSE_STORAGE, JSON.stringify(licenseData), 3650);

        if (typeof gtag !== 'undefined') {
          gtag('event', 'license_activated', {
            'event_category': 'License',
            'event_label': 'License Activated Successfully'
          });
        }
      }

      function checkLicense() {
        const licenseCookie = getCookie(LICENSE_STORAGE);
        const licenseStorage = localStorage.getItem(LICENSE_STORAGE);

        if (licenseCookie || licenseStorage) {
          try {
            const license = JSON.parse(licenseCookie || licenseStorage);
            if (validateLicenseKey(license.key)) return true;
          } catch(e) {}
        }
        return false;
      }

      function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        document.cookie = name + "=" + value + ";expires=" + date.toUTCString() + ";path=/;SameSite=Strict";
      }

      function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
          let c = ca[i].trim();
          if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length);
        }
        return null;
      }

      function checkTrialStatus() {
        let firstVisit = getCookie(COOKIE_NAME) || localStorage.getItem(STORAGE_NAME);
        const currentTime = Date.now();

        if (!firstVisit) {
          const visitTime = currentTime.toString();
          setCookie(COOKIE_NAME, visitTime, 365);
          localStorage.setItem(STORAGE_NAME, visitTime);

          if (typeof gtag !== 'undefined') {
            gtag('event', 'trial_started', {
              'event_category': 'Trial',
              'event_label': 'New Trial Started'
            });
          }

          return { isExpired: false, timeLeft: TRIAL_DURATION };
        }

        const firstVisitTime = parseInt(firstVisit);
        const timeElapsed = currentTime - firstVisitTime;
        const timeLeft = TRIAL_DURATION - timeElapsed;

        return {
          isExpired: timeElapsed >= TRIAL_DURATION,
          timeLeft: Math.max(0, timeLeft)
        };
      }

      function disableAllInputs() {
        setTimeout(() => {
          const inputs = document.querySelectorAll('input:not(.license-input), textarea, select, button:not(.license-btn):not(.whatsapp-btn)');
          inputs.forEach(input => {
            input.disabled = true;
            input.style.opacity = '0.5';
            input.style.cursor = 'not-allowed';
          });
        }, 100);
      }

      function isIncognitoMode() {
        return new Promise((resolve) => {
          try {
            localStorage.setItem('incognito_test', '1');
            localStorage.removeItem('incognito_test');

            if ('storage' in navigator && 'estimate' in navigator.storage) {
              navigator.storage.estimate().then(({quota}) => {
                resolve(quota < 120000000);
              }).catch(() => resolve(false));
            } else {
              resolve(false);
            }
          } catch(e) {
            resolve(true);
          }
        });
      }

      function disableToolCompletely() {
        const style = document.createElement('style');
        style.textContent = `
          input, textarea, select, button {
            pointer-events: none !important;
            opacity: 0.3 !important;
            cursor: not-allowed !important;
          }
        `;
        document.head.appendChild(style);

        document.addEventListener('click', e => { e.preventDefault(); e.stopPropagation(); }, true);
        document.addEventListener('keydown', e => { e.preventDefault(); e.stopPropagation(); }, true);
      }

      function showIncognitoBlockScreen() {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'incognito_blocked', {
            'event_category': 'Security',
            'event_label': 'Incognito Mode Blocked'
          });
        }

        const overlay = document.createElement('div');
        overlay.style.cssText = `
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(15px);
          z-index: 999999; display: flex; align-items: center; justify-content: center;
        `;

        overlay.innerHTML = `
          <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
            border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 24px; padding: 48px;
            max-width: 500px; text-align: center; box-shadow: 0 24px 70px rgba(0, 0, 0, 0.8);">
            <div style="font-size: 80px; margin-bottom: 24px;">ğŸš«</div>
            <h2 style="font-size: 32px; font-weight: 900; margin-bottom: 16px; color: #fff;">
              Ø§Ù„ØªØµÙØ­ Ø§Ù„Ù…Ø®ÙÙŠ Ù…Ø­Ø¸ÙˆØ±!
            </h2>
            <p style="font-size: 18px; color: rgba(255, 255, 255, 0.95); margin-bottom: 32px; line-height: 1.8;">
              Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ø§ ØªØ¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØµÙØ­ Ø§Ù„Ù…Ø®ÙÙŠ.<br><br>
              <strong>Ø§ÙØªØ­ Ø§Ù„Ø£Ø¯Ø§Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¹Ø§Ø¯ÙŠØ© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</strong>
            </p>
          </div>
        `;

        document.body.appendChild(overlay);
      }

      function createTrialHeader() {
        const header = document.createElement('div');
        header.id = 'trialHeader';
        header.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          background: linear-gradient(
            135deg,
            rgba(139, 92, 246, 0.08),
            rgba(34, 211, 238, 0.08)
          );
          backdrop-filter: blur(10px);
          border-bottom: 1px solid rgba(139, 92, 246, 0.2);
          padding: 12px 24px;
          z-index: 9998;
          box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 20px;
          flex-wrap: wrap;
        `;

        const status = checkTrialStatus();
        const hours = Math.floor(status.timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((status.timeLeft % (1000 * 60 * 60)) / (1000 * 60));

        header.innerHTML = `
          <div style="display: flex; align-items: center; gap: 12px; flex: 1; min-width: 250px;">
            <div style="
              background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(34, 211, 238, 0.15));
              padding: 8px 16px;
              border-radius: 12px;
              border: 1px solid rgba(139, 92, 246, 0.3);
              display: flex;
              align-items: center;
              gap: 10px;
            ">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="color: #8b5cf6;">
                <circle cx="12" cy="12" r="10" stroke-width="2"/>
                <path d="M12 6v6l4 2" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <div>
                <div style="font-size: 10px; color: rgba(255, 255, 255, 0.6); font-weight: 600; letter-spacing: 0.5px;">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div>
                <div id="timerDisplay" style="color: #22d3ee; font-weight: 900; font-size: 16px; direction: ltr; text-align: left;">
                  ${hours}h ${minutes}m
                </div>
              </div>
            </div>
          </div>

          <div style="display: flex; align-items: center; gap: 10px; flex: 1; min-width: 300px; max-width: 500px;">
            <input 
              type="text" 
              class="license-input"
              placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„"
              style="
                flex: 1;
                padding: 10px 16px;
                border: 2px solid rgba(139, 92, 246, 0.3);
                border-radius: 10px;
                background: rgba(255, 255, 255, 0.05);
                color: rgba(255, 255, 255, 0.9);
                font-size: 14px;
                font-weight: 600;
                text-align: center;
                letter-spacing: 0.5px;
                text-transform: uppercase;
                transition: all 0.3s;
              "
            />
            <button class="license-btn" style="
              padding: 10px 24px;
              background: linear-gradient(135deg, #22c55e, #16a34a);
              color: white;
              border: none;
              border-radius: 10px;
              font-weight: 700;
              font-size: 14px;
              cursor: pointer;
              white-space: nowrap;
              transition: all 0.3s;
              box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(34, 197, 94, 0.4)';"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(34, 197, 94, 0.3)';">
              âœ¨ ØªÙØ¹ÙŠÙ„
            </button>
          </div>

          <div id="licenseMsg" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 600; min-width: 150px; text-align: center;"></div>
        `;

        document.body.appendChild(header);
        document.body.style.paddingTop = '80px';

        setInterval(() => {
          const s = checkTrialStatus();
          if (s.isExpired) {
            location.reload();
          }
          const h = Math.floor(s.timeLeft / (1000 * 60 * 60));
          const m = Math.floor((s.timeLeft % (1000 * 60 * 60)) / (1000 * 60));
          document.getElementById('timerDisplay').innerHTML = `${h}h ${m}m`;
        }, 60000);

        const btn = header.querySelector('.license-btn');
        const input = header.querySelector('.license-input');
        const msg = document.getElementById('licenseMsg');

        input.addEventListener('focus', function() {
          this.style.borderColor = 'rgba(139, 92, 246, 0.6)';
          this.style.background = 'rgba(255, 255, 255, 0.08)';
        });

        input.addEventListener('blur', function() {
          this.style.borderColor = 'rgba(139, 92, 246, 0.3)';
          this.style.background = 'rgba(255, 255, 255, 0.05)';
        });

        btn.addEventListener('click', () => {
          const key = input.value.trim();
          if (!key) {
            msg.style.color = '#fca5a5';
            msg.textContent = 'âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯';
            setTimeout(() => msg.textContent = '', 3000);
            return;
          }

          if (validateLicenseKey(key)) {
            activateLicense(key);
            msg.style.color = '#86efac';
            msg.textContent = 'âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„!';
            setTimeout(() => location.reload(), 1500);
          } else {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'license_failed', {
                'event_category': 'License',
                'event_label': 'Invalid License Key Entered'
              });
            }

            msg.style.color = '#fca5a5';
            msg.textContent = 'âŒ ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦';
            input.style.borderColor = 'rgba(239, 68, 68, 0.8)';
            setTimeout(() => {
              msg.textContent = '';
              input.style.borderColor = 'rgba(139, 92, 246, 0.3)';
            }, 3000);
          }
        });

        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') btn.click();
        });
      }

      function showExpiredScreen() {
        document.getElementById('trialHeader')?.remove();

        if (typeof gtag !== 'undefined') {
          gtag('event', 'trial_expired', {
            'event_category': 'Trial',
            'event_label': 'Trial Period Expired'
          });
        }

        const header = document.createElement('div');
        header.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          background: linear-gradient(
            135deg,
            rgba(139, 92, 246, 0.12),
            rgba(34, 211, 238, 0.12)
          );
          backdrop-filter: blur(12px);
          border-bottom: 2px solid rgba(139, 92, 246, 0.3);
          padding: 24px 20px;
          z-index: 9998;
          box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        `;

        header.innerHTML = `
          <div style="max-width: 600px; margin: 0 auto; text-align: center;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 16px;">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="color: #ef4444;">
                <circle cx="12" cy="12" r="10" stroke-width="2"/>
                <path d="M12 6v6l4 2" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <h2 style="font-size: 22px; font-weight: 800; color: rgba(255, 255, 255, 0.95); margin: 0;">
                Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
              </h2>
            </div>
            <p style="font-size: 15px; color: rgba(255, 255, 255, 0.8); margin-bottom: 20px; line-height: 1.6;">
              Ù„Ù‚Ø¯ Ø§Ø³ØªÙ…ØªØ¹Øª Ø¨ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø©. <br>
              Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯Ø§Ø© Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø´Ø±Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©.
            </p>

            <button class="whatsapp-btn" style="
              width: 100%;
              max-width: 400px;
              padding: 14px 32px;
              background: linear-gradient(135deg, #25D366, #128C7E);
              color: white;
              border: none;
              border-radius: 12px;
              font-weight: 700;
              font-size: 17px;
              cursor: pointer;
              margin-bottom: 16px;
              transition: all 0.3s;
              box-shadow: 0 4px 16px rgba(37, 211, 102, 0.4);
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(37, 211, 102, 0.5)';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(37, 211, 102, 0.4)';">
              ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø´Ø±Ø§Ø¡
            </button>

            <div style="background: rgba(0, 0, 0, 0.2); padding: 16px; border-radius: 12px; margin-bottom: 12px; border: 1px solid rgba(139, 92, 246, 0.3);">
              <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;">
                <input 
                  type="text" 
                  class="license-input"
                  placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„"
                  style="
                    flex: 1;
                    max-width: 280px;
                    padding: 11px 16px;
                    border: 2px solid rgba(139, 92, 246, 0.4);
                    border-radius: 10px;
                    background: rgba(0, 0, 0, 0.3);
                    color: white;
                    font-size: 14px;
                    font-weight: 600;
                    text-align: center;
                    letter-spacing: 0.5px;
                    text-transform: uppercase;
                  "
                />
                <button class="license-btn" style="
                  padding: 11px 26px;
                  background: linear-gradient(135deg, #22d3ee, #8b5cf6);
                  color: white;
                  border: none;
                  border-radius: 10px;
                  font-weight: 700;
                  font-size: 14px;
                  cursor: pointer;
                  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
                ">
                  âœ¨ ØªÙØ¹ÙŠÙ„
                </button>
              </div>
              <div id="licenseMsg" style="color: rgba(255, 255, 255, 0.9); font-size: 13px; font-weight: 600;"></div>
            </div>

            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(34, 211, 238, 0.15)); padding: 14px; border-radius: 10px; border: 1px solid rgba(139, 92, 246, 0.3);">
              <div style="font-size: 11px; color: rgba(255, 255, 255, 0.7); margin-bottom: 4px; font-weight: 600;">Ø§Ù„Ø³Ø¹Ø±</div>
              <div style="font-size: 26px; font-weight: 900; color: #22d3ee; text-shadow: 0 2px 8px rgba(34, 211, 238, 0.3);">${PRICE}</div>
              <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-top: 3px;">Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø© â€¢ Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©</div>
            </div>
          </div>
        `;

        document.body.appendChild(header);
        document.body.style.paddingTop = '280px';

        header.querySelector('.whatsapp-btn').addEventListener('click', () => {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'whatsapp_clicked', {
              'event_category': 'Conversion',
              'event_label': 'WhatsApp Purchase Button Clicked'
            });
          }

          const msg = encodeURIComponent(`Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ø±ÙŠØ¯ Ø´Ø±Ø§Ø¡ Ø£Ø¯Ø§Ø© COD Pricing Tool Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø© Ø¨Ø³Ø¹Ø± ${PRICE}`);
          window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`, '_blank');
        });

        const btn = header.querySelector('.license-btn');
        const input = header.querySelector('.license-input');
        const msgDiv = header.querySelector('#licenseMsg');

        btn.addEventListener('click', () => {
          const key = input.value.trim();
          if (!key) {
            msgDiv.style.color = '#fca5a5';
            msgDiv.textContent = 'âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„';
            return;
          }

          if (validateLicenseKey(key)) {
            activateLicense(key);
            msgDiv.style.color = '#86efac';
            msgDiv.textContent = 'âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            setTimeout(() => location.reload(), 1500);
          } else {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'license_failed', {
                'event_category': 'License',
                'event_label': 'Invalid License Key After Expiry'
              });
            }

            msgDiv.style.color = '#fca5a5';
            msgDiv.textContent = 'âŒ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø£Ø¯Ø®Ù„ØªÙ‡ ØºÙŠØ± ØµØ­ÙŠØ­';
            input.style.borderColor = 'rgba(239, 68, 68, 0.8)';
          }
        });

        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') btn.click();
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }

      async function init() {
        const isIncognito = await isIncognitoMode();
        if (isIncognito) {
          disableToolCompletely();
          showIncognitoBlockScreen();
          return;
        }

        if (checkLicense()) {
          console.log('âœ… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…ÙØ¹Ù‘Ù„Ø©');
          return;
        }

        const status = checkTrialStatus();

        if (status.isExpired) {
          disableAllInputs();
          showExpiredScreen();
        } else {
          createTrialHeader();
        }
      }
    })();
  </script>
</head>
  
<body>
  <!-- START: ÙƒÙˆØ¯ Ø­Ù…Ø§ÙŠØ© ÙØ§ÙŠØ±Ø¨ÙŠØ³ -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBoDXsELYXl440Wb3bd6xir0sMbj-6LSIA",
        authDomain: "cod-pricing.firebaseapp.com",
        projectId: "cod-pricing",
        storageBucket: "cod-pricing.firebasestorage.app",
        messagingSenderId: "815665273956",
        appId: "1:815665273956:web:6a496b1d28da2aa0b25371",
        measurementId: "G-7XLMBDYNXG"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    onAuthStateChanged(auth, (user) => {
        if (!user) {
            window.location.href = "login.html";
        } else {
            console.log("Logged in as:", user.email);
        }
    });

    window.logout = () => signOut(auth).then(() => window.location.href = "login.html");
</script>
<!-- END: ÙƒÙˆØ¯ Ø­Ù…Ø§ÙŠØ© ÙØ§ÙŠØ±Ø¨ÙŠØ³ -->

  <div class="min-h-screen p-4">
    <div class="w-full max-w-screen-2xl mx-auto">

      <!-- Header -->
      <div id="appHeader" dir="ltr" class="glass soft-border rounded-2xl p-4 mb-6 no-print">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          
          <div class="flex items-center justify-between md:justify-start gap-4">
            <div class="flex items-center gap-3">
              <span class="text-xl font-black gradient-text">Made By Anouar</span>
              <span class="px-3 py-1 rounded-full text-xs font-black"
                    style="background:linear-gradient(135deg, rgba(139,92,246,.92), rgba(34,211,238,.35));border:1px solid rgba(255,255,255,.14);">
                v4.1 PRO
              </span>
            </div>

            <div dir="ltr" class="flex items-center gap-2 md:hidden">
              <a href="https://www.instagram.com/digitalverse" target="_blank" class="text-white/70 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
              </a>
              <a href="https://t.me/digitalverse12" target="_blank" class="text-white/70 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="22" y1="2" x2="11" y2="13"></line>
                  <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
              </a>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between md:justify-end">
            <div class="glass rounded-xl p-2 flex items-center gap-2">
              <button class="btn px-3 py-2 rounded-lg font-extrabold text-sm active" data-currency="DZD" onclick="changeCurrency('DZD')">DZD</button>
              <button class="btn px-3 py-2 rounded-lg font-extrabold text-sm" data-currency="MAD" onclick="changeCurrency('MAD')">MAD</button>
              <button class="btn px-3 py-2 rounded-lg font-extrabold text-sm" data-currency="TND" onclick="changeCurrency('TND')">TND</button>
            </div>

            <div class="glass rounded-xl p-2 flex items-center gap-2">
              <button class="btn px-3 py-2 rounded-lg font-extrabold text-sm active" data-lang="ar" onclick="changeLanguage('ar')">AR</button>
              <button class="btn px-3 py-2 rounded-lg font-extrabold text-sm" data-lang="en" onclick="changeLanguage('en')">EN</button>
              <button class="btn px-3 py-2 rounded-lg font-extrabold text-sm" data-lang="fr" onclick="changeLanguage('fr')">FR</button>
            </div>

            <div dir="ltr" class="hidden md:flex items-center gap-3">
              <a href="https://www.instagram.com/digitalverse" target="_blank" class="text-white/70 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
              </a>
              <a href="https://t.me/digitalverse12" target="_blank" class="text-white/70 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="22" y1="2" x2="11" y2="13"></line>
                  <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
              </a>
            </div>
          </div>
        </div>

        <div class="mt-3 text-xs text-white/70">
          <span class="fx-prefix" data-i18n="fxPrefix">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø§ÙØªØ±Ø§Ø¶ÙŠ (USD â†’ Ø§Ù„Ø¹Ù…Ù„Ø©): </span>
          <span class="font-bold" id="fxHint">DZD 248.00</span>
          <span class="text-white/50"> â€¢ </span>
          <span class="text-white/50" data-i18n="fxHintNote">ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ù…Ù† Ø®Ø§Ù†Ø© â€œØ³Ø¹Ø± Ø§Ù„ØµØ±Ùâ€ ÙˆØ³ÙŠÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</span>
        </div>
      </div>

      <!-- Success Message -->
      <div id="successMessage" class="hidden mb-6 glass rounded-xl p-4 no-print">
        <div class="flex items-center justify-between">
          <span id="successText" class="font-semibold">OK</span>
          <button onclick="hideSuccessMessage()" class="text-white/60 hover:text-white transition-colors">
            <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Main Card -->
      <div class="glass-strong rounded-3xl overflow-hidden">
        <div class="relative p-8 text-center">
          <div class="absolute inset-0" style="background:linear-gradient(90deg, rgba(139,92,246,.18), rgba(34,211,238,.10), rgba(96,165,250,.12));"></div>
          <div class="relative">
            <h1 class="text-4xl md:text-5xl font-black gradient-text mb-3" data-i18n="heroTitle">Ø£Ø¯Ø§Ø© ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
            <p class="text-white/70 text-lg" data-i18n="heroTag">Ø£Ø¯Ø§Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø­Ø³Ø§Ø¨ ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</p>

            <div class="mt-6 grid md:grid-cols-3 gap-3 text-sm text-white/70">
              <div class="glass rounded-xl p-3" data-i18n="heroSub1">ØªÙˆÙ‚Ø¹ Ø£Ø±Ø¨Ø§Ø­Ùƒ ÙˆÙ…ØµØ§Ø±ÙŠÙÙƒ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± 30 ÙŠÙˆÙ…</div>
              <div class="glass rounded-xl p-3" data-i18n="heroSub2">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø£Ù…Ø«Ù„ Ø¯ÙˆÙ† Ø®Ø³Ø§Ø±Ø© Ø£Ø±Ø¨Ø§Ø­Ùƒ</div>
              <div class="glass rounded-xl p-3" data-i18n="heroSub3">ØªØµÙˆØ± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø´ÙƒÙ„ Ù…Ø±Ø¦ÙŠ ÙˆØ³Ù‡Ù„ Ø§Ù„ÙÙ‡Ù…</div>
            </div>
          </div>
        </div>

        <!-- Tabs -->
        <div class="glass border-y border-white/10 no-print">
          <div class="flex gap-2 overflow-x-auto px-6 py-2">
            <button class="tab-button active" onclick="switchTab('calculator', this)" data-i18n="tab_calculator">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ³Ø¹ÙŠØ±</button>
            <button class="tab-button" onclick="switchTab('monthly', this)" data-i18n="tab_monthly">ØªÙˆÙ‚Ø¹Ø§Øª Ø´Ù‡Ø±ÙŠØ©</button>
            <button class="tab-button" onclick="switchTab('discounts', this)" data-i18n="tab_discounts">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</button>
            <button class="tab-button" onclick="switchTab('charts', this)" data-i18n="tab_charts">Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</button>
          </div>
        </div>

        <!-- Scenario Buttons -->
        <div class="p-6 border-b border-white10 no-print">
          <div class="flex flex-wrap gap-3 justify-center">
            <button onclick="applyScenario(1)" class="scenario-btn px-6 py-3 rounded-xl font-bold flex items-center gap-2">ğŸ§± Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 01</button>
            <button onclick="applyScenario(2)" class="scenario-btn px-6 py-3 rounded-xl font-bold flex items-center gap-2">ğŸŸ  Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 02</button>
            <button onclick="applyScenario(3)" class="scenario-btn px-6 py-3 rounded-xl font-bold flex items-center gap-2">ğŸ”· Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 03</button>
            <button onclick="applyScenario(4)" class="scenario-btn px-6 py-3 rounded-xl font-bold flex items-center gap-2">ğŸš€ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 04</button>
          </div>
          <div class="mt-3 text-center text-xs text-white60">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙŠÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø«Ù… ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø£ÙŠ Ø±Ù‚Ù… ÙŠØ¯ÙˆÙŠÙ‹Ø§).</div>
        </div>

        <!-- Tab: Calculator -->
        <div id="tab-calculator" class="tab-content active p-6">
          <div class="grid lg:grid-cols-2 gap-8">
            <!-- Inputs -->
            <div class="space-y-6">
              <div class="flex items-center gap-3 mb-2">
                <h2 class="text-2xl font-bold gradient-text" data-i18n="inputsTitle">Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</h2>
              </div>
              <div>
                <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_productName">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                <input type="text" id="productName" class="w-full px-4 py-3 rounded-xl premium-input" data-i18n-placeholder="ph_productName" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ©" />
              </div>
              <div class="grid sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_wholesale">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø§Ù„Ø¬Ù…Ù„Ø© (USD)</label>
                  <input type="number" id="wholesalePrice" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="1200" oninput="calculate()" />
                </div>
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_exchange">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</label>
                  <input type="number" id="exchangeRate" class="w-full px-4 py-3 rounded-xl premium-input" value="248" oninput="onExchangeInput()" />
                </div>
              </div>
              <div class="grid sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_confirm">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ (%)</label>
                  <input type="number" id="confirmRate" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="60" oninput="calculate()" />
                </div>
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_delivery">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ (%)</label>
                  <input type="number" id="deliveryRate" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="80" oninput="calculate()" />
                </div>
              </div>
              <div class="grid sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_dailyBudget">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (USD)</label>
                  <input type="number" id="dailyAdSpend" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="25" oninput="calculate()" />
                </div>
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_cpo">Ø§Ù„ØªÙƒÙ„ÙØ© Ù„ÙƒÙ„ Ø·Ù„Ø¨ (USD)</label>
                  <input type="number" id="costPerOrder" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="2.5" oninput="calculate()" />
                </div>
              </div>
              <div class="grid sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_extra">ØªÙƒØ§Ù„ÙŠÙ Ø¥Ø¶Ø§ÙÙŠØ© (Ø¯Ø¬)</label>
                  <input type="number" id="additionalCosts" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="200" oninput="calculate()" />
                </div>
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_returnCost">ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ù„ÙƒÙ„ Ø·Ù„Ø¨ (Ø¯Ø¬)</label>
                  <input type="number" id="returnCost" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="300" oninput="calculate()" />
                </div>
              </div>
              <div class="grid sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_finalPrice">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø¯Ø¬)</label>
                  <input type="number" id="finalPrice" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="..." oninput="onFinalPriceChange()" />
                  <div class="text-center text-xs text-white/60 mt-1" data-i18n="hint_finalPrice">Ø¥Ø°Ø§ ÙƒØªØ¨Øª Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
                </div>
                <div>
                  <label class="block text-sm font-semibold mb-2 text-white" data-i18n="lbl_profitMargin">Ø§Ù„Ø±Ø¨Ø­ (Ø¯Ø¬)</label>
                  <input type="number" id="profitMarginInput" class="w-full px-4 py-3 rounded-xl premium-input" placeholder="800" oninput="onProfitMarginChange()" />
                  <div class="text-center text-xs text-white/60 mt-1" data-i18n="hint_profit">Ø¥Ø°Ø§ ÙƒØªØ¨Øª Ø§Ù„Ø±Ø¨Ø­ ÙŠØªÙ… Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
                </div>
              </div>
            </div>

            <!-- Results -->
            <div class="space-y-6">
              <div id="lossWarning" class="hidden stat-card border-2" style="border-color:rgba(239,68,68,.45);">
                <div class="font-bold text-lg" data-i18n="lossWarning">ØªØ­Ø°ÙŠØ±: Ø£Ù†Øª ÙÙŠ Ø®Ø³Ø§Ø±Ø©</div>
                <div class="text-white/70 text-sm mt-1" data-i18n="lossHint">Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¹Ø± Ø£Ùˆ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ù‚Ø¨Ù„ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø§Øª.</div>
              </div>

              <div class="stat-card">
                <h3 class="font-bold mb-4 text-lg" data-i18n="sec_orders">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:</h3>
                <div class="space-y-3 text-sm">
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="dailyOrders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span><span id="dailyOrders" class="font-bold">0</span></div>
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="confirmedOrders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©:</span><span id="confirmedOrders" class="font-bold text-sky-300">0</span></div>
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="deliveredOrders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:</span><span id="deliveredOrders" class="font-bold text-emerald-300">0</span></div>
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="returnedOrders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©:</span><span id="returnedOrders" class="font-bold text-red-300">0</span></div>
                  <div class="flex justify-between pt-3 border-t border-white/10">
                    <span class="font-semibold text-white" data-i18n="returnRate">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹:</span>
                    <span id="returnRate" class="font-bold text-orange-300">0</span>
                  </div>
                  <div id="returnCostRow" class="hidden flex justify-between pt-3 border-t border-white/10">
                    <span class="font-semibold text-white" data-i18n="returnCostDaily">ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span>
                    <span id="totalReturnCost" class="font-bold text-red-300">0</span>
                  </div>
                </div>
              </div>

              <div class="stat-card">
                <h3 class="font-bold mb-4 text-lg" data-i18n="sec_marketing">ØªØ­Ù„ÙŠÙ„ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ³ÙˆÙŠÙ‚</h3>
                <div class="space-y-3 text-sm">
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="cpo">Ø§Ù„ØªÙƒÙ„ÙØ© Ù„ÙƒÙ„ Ø·Ù„Ø¨:</span><span id="costPerOrderDisplay" class="font-bold">0</span></div>
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="finalCpo">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©:</span><span id="finalCostPerOrder" class="font-bold text-red-300">0</span></div>
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="finalCpoDzd">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© (DZD):</span><span id="finalCostDZD" class="font-bold text-white/80">0</span></div>
                </div>
              </div>

              <div class="stat-card">
                <h3 class="font-bold mb-4 text-lg" data-i18n="sec_costDetails">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©</h3>
                <div class="space-y-3 text-sm">
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="wholesaleLine">Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©:</span><span id="wholesalePriceDisplay" class="font-bold">0</span></div>
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="adsLine">ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:</span><span id="adCostDisplay" class="font-bold">0</span></div>
                  <div id="additionalCostsRow" class="hidden flex justify-between"><span class="text-white/70" data-i18n="extraLine">ØªÙƒØ§Ù„ÙŠÙ Ø¥Ø¶Ø§ÙÙŠØ©:</span><span id="additionalCostsDisplay" class="font-bold">0</span></div>
                  <div class="flex justify-between pt-3 border-t border-white/10">
                    <span class="font-semibold text-lg text-white" data-i18n="totalCost">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>
                    <span id="totalCost" class="font-bold text-2xl text-red-300">0</span>
                  </div>
                </div>
              </div>

              <div class="stat-card text-center">
                <div class="text-sm text-white/80 mb-2" data-i18n="suggestedFinalPrice">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ù‚ØªØ±Ø­</div>
                <div id="finalPriceDisplay" class="text-5xl md:text-6xl font-black gradient-text mb-3">0</div>
                <div class="text-sm text-white/60 mb-5" data-i18n="currencyNote">Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± (DZD) Ø­Ø³Ø¨ Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <div class="space-y-3 pt-5 border-t border-white/10">
                  <div class="flex justify-between items-center">
                    <span class="text-white/70" data-i18n="profitMargin">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­:</span>
                    <span id="profitMarginDisplay" class="text-2xl font-bold">0</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-white/70" data-i18n="netProfit">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ:</span>
                    <span id="netProfitDisplay" class="text-xl font-bold">0</span>
                  </div>
                </div>
              </div>

              <div class="stat-card">
                <h3 class="font-bold text-center mb-4 text-xl" data-i18n="sec_dailyProfit">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                <div class="text-center">
                  <div id="dailyNetProfit" class="text-5xl font-black">0</div>
                  <div class="text-xs text-white/70 mt-2 glass rounded-xl p-3">
                    <span data-i18n="profitFormula">Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:</span>
                    <span id="dailyProfitCalc">0</span>
                  </div>
                </div>
              </div>

              <div class="stat-card">
                <h3 class="font-bold mb-4 text-lg" data-i18n="sec_roi">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</h3>
                <div class="space-y-3 text-sm">
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="revenue">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span><span id="revenue" class="font-bold text-emerald-300">0</span></div>
                  <div class="flex justify-between"><span class="text-white/70" data-i18n="dailyCosts">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span><span id="totalDailyCosts" class="font-bold text-red-300">0</span></div>
                  <div class="flex justify-between pt-3 border-t border-white/10">
                    <span class="font-semibold text-lg text-white" data-i18n="roi">ROI</span>
                    <span id="roi" class="font-bold text-3xl gradient-text">0</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Monthly -->
        <div id="tab-monthly" class="tab-content p-6">
          <div class="max-w-5xl mx-auto space-y-8">
            <div class="text-center mb-8">
              <h2 class="text-4xl font-black mb-3 gradient-text" data-i18n="monthlyTitle">ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h2>
              <p class="text-white/70 text-lg" data-i18n="monthlyHint">Ø­Ø³Ø§Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¹Ù„Ù‰ 30 ÙŠÙˆÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
            </div>
            <div class="grid md:grid-cols-3 gap-6">
              <div class="stat-card text-center">
                <div class="text-sm text-white/70 mb-2" data-i18n="monthlyRevenue">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
                <div id="monthlyRevenue" class="text-5xl font-black text-emerald-300">0</div>
              </div>
              <div class="stat-card text-center">
                <div class="text-sm text-white/70 mb-2" data-i18n="monthlyCosts">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
                <div id="monthlyCosts" class="text-5xl font-black text-red-300">0</div>
              </div>
              <div class="stat-card text-center">
                <div class="text-sm text-white/70 mb-2" data-i18n="monthlyProfit">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
                <div id="monthlyProfit" class="text-5xl font-black text-purple-300">0</div>
              </div>
            </div>
            <div class="stat-card">
              <h3 class="text-2xl font-bold mb-6 gradient-text" data-i18n="monthlyDetails">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ù‡Ø±</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center glass rounded-xl p-4">
                  <span class="text-white/70" data-i18n="monthlyOrders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span>
                  <span id="monthlyOrders" class="font-bold text-xl">0</span>
                </div>
                <div class="flex justify-between items-center glass rounded-xl p-4">
                  <span class="text-white/70" data-i18n="monthlyDelivered">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</span>
                  <span id="monthlyDelivered" class="font-bold text-xl text-emerald-300">0</span>
                </div>
                <div class="flex justify-between items-center glass rounded-xl p-4">
                  <span class="text-white/70" data-i18n="monthlyReturned">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©</span>
                  <span id="monthlyReturned" class="font-bold text-xl text-red-300">0</span>
                </div>
                <div class="flex justify-between items-center glass rounded-xl p-4">
                  <span class="text-white/70" data-i18n="monthlyReturnCost">ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span>
                  <span id="monthlyReturnCost" class="font-bold text-xl text-orange-300">0</span>
                </div>
                <div class="flex justify-between items-center glass rounded-xl p-4 font-bold border-t-2" style="border-color:rgba(139,92,246,.35);">
                  <span class="text-lg" data-i18n="monthlyROI">ROI</span>
                  <span id="monthlyROI" class="text-3xl gradient-text">0</span>
                </div>
              </div>
            </div>
            <div class="stat-card">
              <h3 class="text-2xl font-bold mb-6 gradient-text" data-i18n="monthlyInsightsTitle">Ù†ØµØ§Ø¦Ø­ Ø°ÙƒÙŠØ©</h3>
              <div id="monthlyInsights" class="space-y-3"></div>
            </div>
          </div>
        </div>

        <!-- Tab: Discounts -->
        <div id="tab-discounts" class="tab-content p-6">
          <div class="max-w-5xl mx-auto space-y-8">
            <div class="text-center mb-8">
              <h2 class="text-4xl font-black mb-3 gradient-text" data-i18n="discountsTitle">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª</h2>
              <p class="text-white/70 text-lg" data-i18n="discountsHint">Ø§Ø®ØªØ± Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… ÙˆØ´Ø§Ù‡Ø¯ ØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¨Ø­</p>
            </div>
            <div class="stat-card">
              <h3 class="text-xl font-bold mb-6" data-i18n="discountSliderTitle">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…</h3>
              <input type="range" id="discountSlider" min="0" max="50" value="0" step="5" class="w-full mb-6" oninput="calculateDiscount()" />
              <div class="text-center">
                <span id="discountPercent" class="text-7xl font-black gradient-text">0</span>
                <span class="text-3xl text-white/60 font-bold">%</span>
              </div>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="stat-card text-center">
                <div class="text-sm text-white/70 mb-2" data-i18n="discountedPriceTitle">Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…</div>
                <div id="discountedPrice" class="text-5xl font-black text-purple-300">0</div>
              </div>
              <div class="stat-card text-center">
                <div class="text-sm text-white/70 mb-2" data-i18n="discountedProfitTitle">Ø§Ù„Ø±Ø¨Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…</div>
                <div id="discountedProfit" class="text-5xl font-black">0</div>
              </div>
            </div>
            <div class="stat-card">
              <h3 class="text-2xl font-bold mb-6 gradient-text" data-i18n="discountsTableTitle">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h3>
              <div id="discountTable" class="space-y-3"></div>
            </div>
          </div>
        </div>

        <!-- Tab: Charts -->
        <div id="tab-charts" class="tab-content p-6">
          <div class="max-w-7xl mx-auto space-y-8">
            <div class="text-center mb-8">
              <h2 class="text-4xl font-black mb-3 gradient-text" data-i18n="chartsTitle">Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„</h2>
              <p class="text-white/70 text-lg" data-i18n="chartsHint">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ… ÙŠØªÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨</p>
            </div>
            <div class="grid lg:grid-cols-2 gap-8">
              <div class="stat-card">
                <h3 class="text-xl font-bold mb-6 text-center gradient-text" data-i18n="chart_cost_breakdown">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</h3>
                <div class="chart-frame">
                  <div class="chart-inner">
                    <div class="chart-container"><canvas id="costPieChart"></canvas></div>
                  </div>
                </div>
              </div>
              <div class="stat-card">
                <h3 class="text-xl font-bold mb-6 text-center gradient-text" data-i18n="chart_profit_overview">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
                <div class="chart-frame">
                  <div class="chart-inner">
                    <div class="chart-container"><canvas id="profitBarChart"></canvas></div>
                  </div>
                </div>
              </div>
              <div class="stat-card lg:col-span-2">
                <h3 class="text-xl font-bold mb-6 text-center gradient-text" data-i18n="chart_daily_profit">ØªÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ (30 ÙŠÙˆÙ…)</h3>
                <div class="chart-frame">
                  <div class="chart-inner">
                    <div class="chart-container" style="height:380px"><canvas id="monthlyLineChart"></canvas></div>
                  </div>
                </div>
              </div>
              <div class="stat-card">
                <h3 class="text-xl font-bold mb-6 text-center gradient-text" data-i18n="chart_orders">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <div class="chart-frame">
                  <div class="chart-inner">
                    <div class="chart-container"><canvas id="ordersDonutChart"></canvas></div>
                  </div>
                </div>
              </div>
              <div class="stat-card">
                <h3 class="text-xl font-bold mb-6 text-center gradient-text" data-i18n="chart_roi">ROI</h3>
                <div class="chart-frame">
                  <div class="chart-inner">
                    <div class="chart-container"><canvas id="roiChart"></canvas></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 justify-center py-8 no-print">
          <button class="btn px-6 py-3 rounded-xl font-bold flex items-center gap-2" onclick="saveData()">
            ğŸ’¾ <span data-i18n="btn_save">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
          </button>
          <button class="btn px-6 py-3 rounded-xl font-bold flex items-center gap-2" onclick="loadData()">
            ğŸ“‚ <span data-i18n="btn_load">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</span>
          </button>
          <button class="btn-gradient px-6 py-3 rounded-xl flex items-center gap-2" onclick="exportToPDF()">
            ğŸ“„ <span data-i18n="btn_pdf">ØªØµØ¯ÙŠØ± PDF</span>
          </button>
          <button class="btn px-6 py-3 rounded-xl font-bold flex items-center gap-2 text-red-300" onclick="resetAll()">
            ğŸ—‘ï¸ <span data-i18n="btn_reset">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</span>
          </button>
          <button class="btn px-6 py-3 rounded-xl font-bold flex items-center gap-2 text-sky-300" onclick="loadExample()">
            ğŸ’¡ <span data-i18n="btn_example">Ù…Ø«Ø§Ù„ ØªÙˆØ¶ÙŠØ­ÙŠ</span>
          </button>
        </div>

      </div>

      <div class="text-center mt-12 mb-8 opacity-60 text-sm no-print">
        <div class="font-bold text-white mb-1" data-i18n="footerTitle">PRO â€¢ COD Pricing Tool</div>
        <div data-i18n="footerSub">v4.1 PRO â€¢ Dark Theme â€¢ PDF â€¢ Monthly â€¢ Charts â€¢ Discounts</div>
      </div>
    </div>
  </div>

  <!-- Ø²Ø± Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù… -->
  <button id="geminiChatBtn" style="
            position: fixed; bottom: 25px; right: 25px; z-index: 2147483647;
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 10px 30px rgba(37,99,235,0.4);
            border: 2px solid rgba(255,255,255,0.2);
            color: white; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
            <svg width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
  </button>

  <div id="geminiChatWindow" style="
            display: none; position: fixed; bottom: 95px; right: 25px;
            width: 350px; height: 500px; background: #0f172a;
            border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
            z-index: 2147483647; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            flex-direction: column; overflow: hidden; font-family: 'Tajawal', sans-serif;
        ">
            <div style="padding: 15px; background: linear-gradient(to right, #3b82f6, #1d4ed8); color: white; display: flex; justify-content: space-between; align-items: center;">
                <div style="font-weight: bold; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">âœ¨</span> Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ
                </div>
                <button id="closeGeminiChat" style="background:none; border:none; color:white; font-size: 24px; cursor:pointer;">&times;</button>
            </div>

            <div id="geminiMessages" style="flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #0f172a;">
                <div style="background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 12px 12px 2px 12px; align-self: flex-start; max-width: 85%; font-size: 14px; border: 1px solid rgba(255,255,255,0.05);">
                    Ù…Ø±Ø­Ø¨Ø§Ù‹! ğŸ‘‹ Ø£Ù†Ø§ Ø£Ø¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ù…Ø­Ø±Ùƒ Google Gemini Ø§Ù„Ù…ØªØ·ÙˆØ±. ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯ÙƒØŸ
                </div>
            </div>

            <form id="geminiForm" style="padding: 12px; background: #1e293b; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 8px;">
                <input type="text" id="geminiInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." style="flex: 1; background: #0f172a; border: 1px solid #334155; color: white; padding: 10px; border-radius: 10px; outline: none;">
                <button type="submit" style="background: #3b82f6; color: white; border: none; padding: 0 15px; border-radius: 10px; cursor: pointer;">â¤</button>
            </form>
  </div>

  <script>
    // ================== CHATBOT LOGIC ==================
    const btn = document.getElementById('geminiChatBtn');
    const win = document.getElementById('geminiChatWindow');
    const close = document.getElementById('closeGeminiChat');
    const form = document.getElementById('geminiForm');
    const input = document.getElementById('geminiInput');
    const msgs = document.getElementById('geminiMessages');

    function toggle() {
        win.style.display = (win.style.display === 'none') ? 'flex' : 'none';
        if (win.style.display === 'flex') input.focus();
    }
    btn.onclick = toggle;
    close.onclick = toggle;

    form.onsubmit = async (e) => {
        e.preventDefault();
        const txt = input.value.trim();
        if (!txt) return;

        // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        msgs.innerHTML += `<div style="background: #3b82f6; color: white; padding: 10px 15px; border-radius: 15px 15px 15px 2px; align-self: flex-end; max-width: 85%; font-size: 14px;">${txt}</div>`;
        msgs.scrollTop = msgs.scrollHeight;
        input.value = '';
        input.disabled = true;

        // Loading
        const loadId = 'loading-' + Date.now();
        msgs.innerHTML += `<div id="${loadId}" style="color: #94a3b8; font-size: 12px; margin-right: 10px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...</div>`;
        msgs.scrollTop = msgs.scrollHeight;

        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: txt })
            });

            const data = await res.json();
            document.getElementById(loadId).remove();

            if (res.ok) {
                msgs.innerHTML += `<div style="background: #1e293b; color: #e2e8f0; padding: 10px 15px; border-radius: 15px 15px 2px 15px; align-self: flex-start; max-width: 85%; font-size: 14px; border: 1px solid rgba(255,255,255,0.05);">${data.reply}</div>`;
            } else {
                msgs.innerHTML += `<div style="background: rgba(220,38,38,0.2); color: #fca5a5; padding: 10px; border-radius: 10px; font-size: 12px; text-align: center;">Ø®Ø·Ø£: ${data.reply}</div>`;
            }

        } catch (err) {
            document.getElementById(loadId)?.remove();
            msgs.innerHTML += `<div style="color: #ef4444; font-size: 12px; text-align: center;">ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${err.message}</div>`;
        } finally {
            input.disabled = false;
            input.focus();
            msgs.scrollTop = msgs.scrollHeight;
        }
    };

    // ================== MAIN TOOL LOGIC ==================
    let currentCurrency = "DZD";
    let currentLang = "ar";
    let isEditingMargin = false;
    let isEditingPrice = false;
    let calculationResults = {};

    const fxRates = { DZD: 248, MAD: 10, TND: 3.1 };
    
    // Translations object (content omitted for brevity, same as before)
    const translations = {
      ar: {
        fxPrefix: "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø§ÙØªØ±Ø§Ø¶ÙŠ (USD â†’ Ø§Ù„Ø¹Ù…Ù„Ø©): ",
        fxHintNote: "ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ù…Ù† Ø®Ø§Ù†Ø© â€œØ³Ø¹Ø± Ø§Ù„ØµØ±Ùâ€ ÙˆØ³ÙŠÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.",
        heroTitle: "Ø£Ø¯Ø§Ø© ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
        heroTag: "Ø£Ø¯Ø§Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø­Ø³Ø§Ø¨ ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±",
        heroSub1: "ØªÙˆÙ‚Ø¹ Ø£Ø±Ø¨Ø§Ø­Ùƒ ÙˆÙ…ØµØ§Ø±ÙŠÙÙƒ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± 30 ÙŠÙˆÙ…",
        heroSub2: "Ø§Ø­Ø³Ø¨ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø£Ù…Ø«Ù„ Ø¯ÙˆÙ† Ø®Ø³Ø§Ø±Ø© Ø£Ø±Ø¨Ø§Ø­Ùƒ",
        heroSub3: "ØªØµÙˆØ± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø´ÙƒÙ„ Ù…Ø±Ø¦ÙŠ ÙˆØ³Ù‡Ù„ Ø§Ù„ÙÙ‡Ù…",
        tab_calculator: "Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ³Ø¹ÙŠØ±",
        tab_monthly: "ØªÙˆÙ‚Ø¹Ø§Øª Ø´Ù‡Ø±ÙŠØ©",
        tab_discounts: "Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª",
        tab_charts: "Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©",
        btn_save: "Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        btn_load: "Ø§Ø³ØªØ±Ø¬Ø§Ø¹",
        btn_pdf: "ØªØµØ¯ÙŠØ± PDF",
        btn_reset: "Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„",
        btn_example: "Ù…Ø«Ø§Ù„ ØªÙˆØ¶ÙŠØ­ÙŠ",
        inputsTitle: "Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª",
        lbl_productName: "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬",
        ph_productName: "Ù…Ø«Ø§Ù„: Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ©",
        lbl_wholesale: "Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø§Ù„Ø¬Ù…Ù„Ø© (USD)",
        lbl_exchange: "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù",
        lbl_confirm: "Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ (%)",
        lbl_delivery: "Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ (%)",
        lbl_dailyBudget: "Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (USD)",
        lbl_cpo: "Ø§Ù„ØªÙƒÙ„ÙØ© Ù„ÙƒÙ„ Ø·Ù„Ø¨ (USD)",
        lbl_extra: "ØªÙƒØ§Ù„ÙŠÙ Ø¥Ø¶Ø§ÙÙŠØ© (Ø¯Ø¬)",
        lbl_returnCost: "ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ù„ÙƒÙ„ Ø·Ù„Ø¨ (Ø¯Ø¬)",
        lbl_finalPrice: "Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø¯Ø¬)",
        lbl_profitMargin: "Ø§Ù„Ø±Ø¨Ø­ (Ø¯Ø¬)",
        hint_finalPrice: "Ø¥Ø°Ø§ ÙƒØªØ¨Øª Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",
        hint_profit: "Ø¥Ø°Ø§ ÙƒØªØ¨Øª Ø§Ù„Ø±Ø¨Ø­ ÙŠØªÙ… Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",
        lossWarning: "ØªØ­Ø°ÙŠØ±: Ø£Ù†Øª ÙÙŠ Ø®Ø³Ø§Ø±Ø©",
        lossHint: "Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¹Ø± Ø£Ùˆ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ù‚Ø¨Ù„ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø§Øª.",
        sec_orders: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:",
        dailyOrders: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:",
        confirmedOrders: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©:",
        deliveredOrders: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:",
        returnedOrders: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©:",
        returnRate: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹:",
        returnCostDaily: "ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:",
        sec_marketing: "ØªØ­Ù„ÙŠÙ„ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ³ÙˆÙŠÙ‚",
        cpo: "Ø§Ù„ØªÙƒÙ„ÙØ© Ù„ÙƒÙ„ Ø·Ù„Ø¨:",
        finalCpo: "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©:",
        finalCpoDzd: "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© (DZD):",
        sec_costDetails: "ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©",
        wholesaleLine: "Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©:",
        adsLine: "ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:",
        extraLine: "ØªÙƒØ§Ù„ÙŠÙ Ø¥Ø¶Ø§ÙÙŠØ©:",
        totalCost: "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:",
        suggestedFinalPrice: "Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ù‚ØªØ±Ø­",
        currencyNote: "Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± (DZD) Ø­Ø³Ø¨ Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ",
        profitMargin: "Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­:",
        netProfit: "Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ:",
        sec_dailyProfit: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ",
        profitFormula: "Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:",
        sec_roi: "Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±",
        revenue: "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:",
        dailyCosts: "Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:",
        roi: "ROI",
        monthlyTitle: "ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
        monthlyHint: "Ø­Ø³Ø§Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¹Ù„Ù‰ 30 ÙŠÙˆÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©",
        monthlyRevenue: "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
        monthlyCosts: "Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
        monthlyProfit: "Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
        monthlyDetails: "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ù‡Ø±",
        monthlyOrders: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
        monthlyDelivered: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©",
        monthlyReturned: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©",
        monthlyReturnCost: "ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
        monthlyROI: "ROI",
        monthlyInsightsTitle: "Ù†ØµØ§Ø¦Ø­ Ø°ÙƒÙŠØ©",
        discountsTitle: "Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª",
        discountsHint: "Ø§Ø®ØªØ± Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… ÙˆØ´Ø§Ù‡Ø¯ ØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¨Ø­",
        discountSliderTitle: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…",
        discountedPriceTitle: "Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…",
        discountedProfitTitle: "Ø§Ù„Ø±Ø¨Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…",
        discountsTableTitle: "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©",
        chartsTitle: "Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„",
        chartsHint: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ… ÙŠØªÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨",
        chart_cost_breakdown: "ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ",
        chart_profit_overview: "Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­",
        chart_daily_profit: "ØªÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ (30 ÙŠÙˆÙ…)",
        chart_orders: "ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
        chart_roi: "ROI",
        footerTitle: "PRO â€¢ COD Pricing Tool",
        footerSub: "v4.1 PRO â€¢ Dark Theme â€¢ PDF â€¢ Monthly â€¢ Charts â€¢ Discounts",
        msg_pdf_generating: "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF...",
        msg_pdf_done: "ØªÙ… ØªØµØ¯ÙŠØ± PDF Ø¨Ù†Ø¬Ø§Ø­!",
        msg_pdf_error: "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PDF",
        msg_saved: "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!",
        msg_no_saved: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹!",
        msg_loaded: "ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!",
        msg_reset: "ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!",
        msg_example: "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ!",
        confirm_reset: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ",
        insight_profit_high: "Ø±Ø¨Ø­ Ø´Ù‡Ø±ÙŠ Ù…Ù…ØªØ§Ø².",
        insight_profit_mid: "Ø±Ø¨Ø­ Ø¬ÙŠØ¯. Ø­Ø§ÙˆÙ„ Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª.",
        insight_profit_low: "Ø§Ù„Ø±Ø¨Ø­ Ù…Ù†Ø®ÙØ¶. Ø±Ø§Ø¬Ø¹ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ.",
        insight_profit_neg: "Ø£Ù†Øª ÙÙŠ Ø®Ø³Ø§Ø±Ø©. Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø³Ø¹Ø± Ø£Ùˆ Ù‚Ù„Ù‘Ù„ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ.",
        insight_roi_high: "ROI Ù…Ù…ØªØ§Ø² ({roi}%).",
        insight_roi_mid: "ROI Ø¬ÙŠØ¯ ({roi}%).",
        insight_roi_low: "ROI Ù…Ù†Ø®ÙØ¶ ({roi}%).",
        insight_ret_high: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø¹Ø§Ù„ÙŠØ© ({rr}%).",
        insight_ret_low: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù†Ø®ÙØ¶Ø© ({rr}%).",
        status_loss: "Ø®Ø³Ø§Ø±Ø©",
        status_low: "Ù…Ù†Ø®ÙØ¶",
        status_ok: "Ù…Ù‚Ø¨ÙˆÙ„",
        status_good: "Ø¬ÙŠØ¯",
        cur_dzd: "Ø¯Ø¬"
      },
      en: {
        fxPrefix: "Default rate (USD â†’ currency): ",
        fxHintNote: "You can change the exchange rate in the â€œExchange rateâ€ field and it will be saved automatically.",
        heroTitle: "Product Pricing Tool",
        heroTag: "Pro COD pricing tool for e-commerce in Algeria",
        heroSub1: "Forecast profits and costs over 30 days",
        heroSub2: "Find the best discount without losing profit",
        heroSub3: "Visualize your data clearly",
        tab_calculator: "Calculator",
        tab_monthly: "Monthly",
        tab_discounts: "Discounts",
        tab_charts: "Charts",
        btn_save: "Save",
        btn_load: "Load",
        btn_pdf: "PDF",
        btn_reset: "Reset",
        btn_example: "Example",
        inputsTitle: "Inputs",
        lbl_productName: "Product name",
        ph_productName: "Example: Smart watch",
        lbl_wholesale: "Wholesale price (DZD)",
        lbl_exchange: "Exchange rate",
        lbl_confirm: "Confirmation rate (%)",
        lbl_delivery: "Delivery rate (%)",
        lbl_dailyBudget: "Daily budget (USD)",
        lbl_cpo: "Cost per order (USD)",
        lbl_extra: "Additional costs (DZD)",
        lbl_returnCost: "Return cost per order (DZD)",
        lbl_finalPrice: "Final price (DZD)",
        lbl_profitMargin: "Profit (DZD)",
        hint_finalPrice: "If you enter final price, profit will be calculated automatically",
        hint_profit: "If you enter profit, final price will be suggested automatically",
        lossWarning: "Warning: You are losing money",
        lossHint: "Review price or costs before scaling ads.",
        sec_orders: "Expected total orders:",
        dailyOrders: "Daily orders:",
        confirmedOrders: "Confirmed orders:",
        deliveredOrders: "Delivered orders:",
        returnedOrders: "Returned orders:",
        returnRate: "Return rate:",
        returnCostDaily: "Daily return cost:",
        sec_marketing: "Marketing cost analysis",
        cpo: "Cost per order:",
        finalCpo: "Real cost per order:",
        finalCpoDzd: "Real cost (DZD):",
        sec_costDetails: "Cost details",
        wholesaleLine: "Wholesale:",
        adsLine: "Ads cost:",
        extraLine: "Extra costs:",
        totalCost: "Total cost:",
        suggestedFinalPrice: "Suggested final price",
        currencyNote: "In DZD based on current exchange rate",
        profitMargin: "Profit margin:",
        netProfit: "Net profit:",
        sec_dailyProfit: "Daily profit analysis",
        profitFormula: "Formula:",
        sec_roi: "Return on investment",
        revenue: "Daily revenue:",
        dailyCosts: "Daily costs:",
        roi: "ROI",
        monthlyTitle: "Monthly profit forecast",
        monthlyHint: "30-day estimate based on your inputs",
        monthlyRevenue: "Monthly revenue",
        monthlyCosts: "Monthly costs",
        monthlyProfit: "Monthly net profit",
        monthlyDetails: "Monthly details",
        monthlyOrders: "Monthly orders",
        monthlyDelivered: "Delivered orders",
        monthlyReturned: "Returned orders",
        monthlyReturnCost: "Monthly return cost",
        monthlyROI: "ROI",
        monthlyInsightsTitle: "Smart insights",
        discountsTitle: "Discount calculator",
        discountsHint: "Choose a discount and see its impact on profit",
        discountSliderTitle: "Discount percentage",
        discountedPriceTitle: "Discounted price",
        discountedProfitTitle: "Discounted profit",
        discountsTableTitle: "Suggested discounts table",
        chartsTitle: "Charts & analysis",
        chartsHint: "Charts update automatically when you open this tab",
        chart_cost_breakdown: "Cost breakdown",
        chart_profit_overview: "Profit overview",
        chart_daily_profit: "Daily net profit forecast (30 days)",
        chart_orders: "Orders distribution",
        chart_roi: "ROI",
        footerTitle: "PRO â€¢ COD Pricing Tool",
        footerSub: "v4.1 PRO â€¢ Dark Theme â€¢ PDF â€¢ Monthly â€¢ Charts â€¢ Discounts",
        msg_pdf_generating: "Generating PDF...",
        msg_pdf_done: "PDF exported successfully!",
        msg_pdf_error: "Error while generating PDF",
        msg_saved: "Data saved successfully!",
        msg_no_saved: "No saved data found!",
        msg_loaded: "Data loaded successfully!",
        msg_reset: "All data cleared!",
        msg_example: "Example loaded!",
        confirm_reset: "Are you sure you want to clear all data?",
        insight_profit_high: "Excellent monthly profit.",
        insight_profit_mid: "Good profit. Try increasing volume.",
        insight_profit_low: "Low profit. Review your costs.",
        insight_profit_neg: "You are losing money. Adjust price or reduce costs.",
        insight_roi_high: "Excellent ROI ({roi}%).",
        insight_roi_mid: "Good ROI ({roi}%).",
        insight_roi_low: "Low ROI ({roi}%).",
        insight_ret_high: "High return rate ({rr}%).",
        insight_ret_low: "Low return rate ({rr}%).",
        status_loss: "Loss",
        status_low: "Low",
        status_ok: "OK",
        status_good: "Good",
        cur_dzd: "DZD"
      },
      fr: {
        fxPrefix: "Taux par dÃ©faut (USD â†’ devise) : ",
        fxHintNote: "Vous pouvez modifier le taux de change dans le champ Â« Taux de change Â» et il sera enregistrÃ© automatiquement.",
        heroTitle: "Outil de tarification produit",
        heroTag: "Outil pro de tarification COD pour e-commerce en AlgÃ©rie",
        heroSub1: "PrÃ©visions des bÃ©nÃ©fices et coÃ»ts sur 30 jours",
        heroSub2: "Trouvez la meilleure remise sans perdre de profit",
        heroSub3: "Visualisez vos donnÃ©es clairement",
        tab_calculator: "Calculatrice",
        tab_monthly: "Mensuel",
        tab_discounts: "Remises",
        tab_charts: "Graphiques",
        btn_save: "Sauvegarder",
        btn_load: "Charger",
        btn_pdf: "PDF",
        btn_reset: "RÃ©initialiser",
        btn_example: "Exemple",
        inputsTitle: "EntrÃ©es",
        lbl_productName: "Nom du produit",
        ph_productName: "Exemple : Montre intelligente",
        lbl_wholesale: "Prix de gros (USD)",
        lbl_exchange: "Taux de change",
        lbl_confirm: "Taux de confirmation (%)",
        lbl_delivery: "Taux de livraison (%)",
        lbl_dailyBudget: "Budget quotidien (USD)",
        lbl_cpo: "CoÃ»t par commande (USD)",
        lbl_extra: "CoÃ»ts supplÃ©mentaires (DZD)",
        lbl_returnCost: "CoÃ»t de retour par commande (DZD)",
        lbl_finalPrice: "Prix final (DZD)",
        lbl_profitMargin: "Profit (DZD)",
        hint_finalPrice: "Si vous entrez le prix final, le profit sera calculÃ© automatiquement",
        hint_profit: "Si vous entrez le profit, le prix final sera suggÃ©rÃ© automatiquement",
        lossWarning: "Attention : Vous perdez de l'argent",
        lossHint: "RÃ©visez le prix ou les coÃ»ts avant de lancer les pubs.",
        sec_orders: "Commandes totales prÃ©vues :",
        dailyOrders: "Commandes quotidiennes :",
        confirmedOrders: "Commandes confirmÃ©es :",
        deliveredOrders: "Commandes livrÃ©es :",
        returnedOrders: "Commandes retournÃ©es :",
        returnRate: "Taux de retour :",
        returnCostDaily: "CoÃ»t de retour quotidien :",
        sec_marketing: "Analyse des coÃ»ts marketing",
        cpo: "CoÃ»t par commande :",
        finalCpo: "CoÃ»t rÃ©el par commande :",
        finalCpoDzd: "CoÃ»t rÃ©el (DZD) :",
        sec_costDetails: "DÃ©tails des coÃ»ts",
        wholesaleLine: "Prix de gros :",
        adsLine: "CoÃ»t pub :",
        extraLine: "CoÃ»ts extra :",
        totalCost: "CoÃ»t total :",
        suggestedFinalPrice: "Prix final suggÃ©rÃ©",
        currencyNote: "En DZD selon le taux de change actuel",
        profitMargin: "Marge bÃ©nÃ©ficiaire :",
        netProfit: "BÃ©nÃ©fice net :",
        sec_dailyProfit: "Analyse du bÃ©nÃ©fice quotidien",
        profitFormula: "Formule :",
        sec_roi: "Retour sur investissement",
        revenue: "Revenu quotidien :",
        dailyCosts: "CoÃ»ts quotidiens :",
        roi: "ROI",
        monthlyTitle: "PrÃ©visions de bÃ©nÃ©fices mensuels",
        monthlyHint: "Estimation sur 30 jours basÃ©e sur vos entrÃ©es",
        monthlyRevenue: "Revenu mensuel",
        monthlyCosts: "CoÃ»ts mensuels",
        monthlyProfit: "BÃ©nÃ©fice net mensuel",
        monthlyDetails: "DÃ©tails mensuels",
        monthlyOrders: "Commandes mensuelles",
        monthlyDelivered: "Commandes livrÃ©es",
        monthlyReturned: "Commandes retournÃ©es",
        monthlyReturnCost: "CoÃ»t de retour mensuel",
        monthlyROI: "ROI",
        monthlyInsightsTitle: "Conseils intelligents",
        discountsTitle: "Calculatrice de remises",
        discountsHint: "Choisissez une remise et voyez son impact sur le profit",
        discountSliderTitle: "Pourcentage de remise",
        discountedPriceTitle: "Prix aprÃ¨s remise",
        discountedProfitTitle: "Profit aprÃ¨s remise",
        discountsTableTitle: "Tableau des remises suggÃ©rÃ©es",
        chartsTitle: "Graphiques et analyses",
        chartsHint: "Les graphiques se mettent Ã  jour automatiquement Ã  l'ouverture de l'onglet",
        chart_cost_breakdown: "RÃ©partition des coÃ»ts",
        chart_profit_overview: "AperÃ§u des bÃ©nÃ©fices",
        chart_daily_profit: "PrÃ©vision bÃ©nÃ©fice quotidien (30 jours)",
        chart_orders: "RÃ©partition des commandes",
        chart_roi: "ROI",
        footerTitle: "PRO â€¢ COD Pricing Tool",
        footerSub: "v4.1 PRO â€¢ ThÃ¨me Sombre â€¢ PDF â€¢ Mensuel â€¢ Graphiques â€¢ Remises",
        msg_pdf_generating: "GÃ©nÃ©ration du PDF...",
        msg_pdf_done: "PDF exportÃ© avec succÃ¨s !",
        msg_pdf_error: "Erreur lors de la gÃ©nÃ©ration du PDF",
        msg_saved: "DonnÃ©es enregistrÃ©es avec succÃ¨s !",
        msg_no_saved: "Aucune donnÃ©e enregistrÃ©e trouvÃ©e !",
        msg_loaded: "DonnÃ©es chargÃ©es avec succÃ¨s !",
        msg_reset: "Toutes les donnÃ©es effacÃ©es !",
        msg_example: "Exemple chargÃ© !",
        confirm_reset: "ÃŠtes-vous sÃ»r de vouloir effacer toutes les donnÃ©es ?",
        insight_profit_high: "Excellent bÃ©nÃ©fice mensuel.",
        insight_profit_mid: "Bon bÃ©nÃ©fice. Essayez d'augmenter le volume.",
        insight_profit_low: "Faible bÃ©nÃ©fice. RÃ©visez vos coÃ»ts.",
        insight_profit_neg: "Vous perdez de l'argent. Ajustez le prix ou rÃ©duisez les coÃ»ts.",
        insight_roi_high: "Excellent ROI ({roi}%).",
        insight_roi_mid: "Bon ROI ({roi}%).",
        insight_roi_low: "Faible ROI ({roi}%).",
        insight_ret_high: "Taux de retour Ã©levÃ© ({rr}%).",
        insight_ret_low: "Taux de retour faible ({rr}%).",
        status_loss: "Perte",
        status_low: "Faible",
        status_ok: "OK",
        status_good: "Bon",
        cur_dzd: "DA"
      }
    };

    function t(key, params = {}) {
      let str = translations[currentLang][key] || key;
      Object.keys(params).forEach(k => {
        str = str.replace(`{${k}}`, params[k]);
      });
      return str;
    }

    function applyTranslations() {
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        el.textContent = t(key);
      });
      document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
        const key = el.getAttribute("data-i18n-placeholder");
        el.placeholder = t(key);
      });
      const hint = document.getElementById("fxHint");
      if(hint) hint.textContent = `${currentCurrency} ${(getStoredFx(currentCurrency) || fxRates[currentCurrency]).toFixed(2)}`;
    }

    function changeLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang === "ar") ? "rtl" : "ltr";
      setActiveByData("[data-lang]", "lang", lang);
      applyTranslations();
      calculate();
      calculateMonthly();
    }

    function setActiveByData(selector, dataAttr, value) {
      document.querySelectorAll(selector).forEach(btn => {
        if(btn.dataset[dataAttr] === value) btn.classList.add("active");
        else btn.classList.remove("active");
      });
    }

    function changeCurrency(curr) {
      currentCurrency = curr;
      setActiveByData("[data-currency]", "currency", curr);
      
      const stored = getStoredFx(curr);
      const exInput = document.getElementById("exchangeRate");
      if(exInput) {
        exInput.value = stored ? stored : (fxRates[curr] || "");
      }
      
      applyTranslations();
      calculate(); 
      calculateMonthly();
    }

    function onExchangeInput() {
      const val = parseFloat(document.getElementById("exchangeRate").value);
      if(!isNaN(val)) {
        localStorage.setItem(`fx_${currentCurrency}`, val);
        const hint = document.getElementById("fxHint");
        if(hint) hint.textContent = `${currentCurrency} ${val.toFixed(2)}`;
        calculate();
        calculateMonthly();
      }
    }

    function getStoredFx(curr) {
      const s = localStorage.getItem(`fx_${curr}`);
      return s ? parseFloat(s) : null;
    }

    function switchTab(tabName, btnElement) {
      document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
      document.getElementById(`tab-${tabName}`).classList.add("active");
      document.querySelectorAll(".tab-button").forEach(el => el.classList.remove("active"));
      btnElement.classList.add("active");
      
      if(tabName === "charts") updateCharts();
      if(tabName === "discounts") calculateDiscount();
    }
    
    // Scenario Function
    function applyScenario(num) {
      const scenarios = {
        1: { wholesale: 1000, exchange: 250, confirm: 60, delivery: 80, ads: 20, cpo: 2.5, extra: 200, return: 300, profit: 800 },
        2: { wholesale: 1500, exchange: 245, confirm: 70, delivery: 85, ads: 30, cpo: 3.0, extra: 250, return: 350, profit: 1200 },
        3: { wholesale: 2000, exchange: 248, confirm: 50, delivery: 75, ads: 50, cpo: 4.0, extra: 300, return: 400, profit: 1500 },
        4: { wholesale: 800, exchange: 250, confirm: 80, delivery: 90, ads: 15, cpo: 1.5, extra: 150, return: 250, profit: 600 }
      };
      
      const s = scenarios[num];
      if(!s) return;
      
      if(document.getElementById("wholesalePrice")) document.getElementById("wholesalePrice").value = s.wholesale;
      if(document.getElementById("exchangeRate")) document.getElementById("exchangeRate").value = s.exchange;
      if(document.getElementById("confirmRate")) document.getElementById("confirmRate").value = s.confirm;
      if(document.getElementById("deliveryRate")) document.getElementById("deliveryRate").value = s.delivery;
      if(document.getElementById("dailyAdSpend")) document.getElementById("dailyAdSpend").value = s.ads;
      if(document.getElementById("costPerOrder")) document.getElementById("costPerOrder").value = s.cpo;
      if(document.getElementById("additionalCosts")) document.getElementById("additionalCosts").value = s.extra;
      if(document.getElementById("returnCost")) document.getElementById("returnCost").value = s.return;
      
      if(document.getElementById("profitMarginInput")) document.getElementById("profitMarginInput").value = s.profit;
      isEditingMargin = true;
      isEditingPrice = false;
      
      calculate();
      calculateMonthly();
      calculateDiscount();
      showSuccessMessage(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ ${num}`, "info");
    }

    function onFinalPriceChange() {
      isEditingPrice = true;
      isEditingMargin = false;
      calculate();
    }
    function onProfitMarginChange() {
      isEditingMargin = true;
      isEditingPrice = false;
      calculate();
    }

    function calculate() {
      const wholesale = parseFloat(document.getElementById("wholesalePrice").value) || 0;
      const exchange = parseFloat(document.getElementById("exchangeRate").value) || 0;
      const confirm = parseFloat(document.getElementById("confirmRate").value) || 0;
      const delivery = parseFloat(document.getElementById("deliveryRate").value) || 0;
      const dailyAd = parseFloat(document.getElementById("dailyAdSpend").value) || 0;
      const costPer = parseFloat(document.getElementById("costPerOrder").value) || 0;
      const additionalCostsValue = parseFloat(document.getElementById("additionalCosts").value) || 0;
      const returnCost = parseFloat(document.getElementById("returnCost").value) || 0;

      const dailyOrders = costPer > 0 ? (dailyAd / costPer) : 0;
      const confirmedOrders = dailyOrders * (confirm / 100);
      const deliveredOrders = confirmedOrders * (delivery / 100);
      const returnedOrders = confirmedOrders - deliveredOrders;
      const returnRate = confirmedOrders > 0 ? (returnedOrders / confirmedOrders) * 100 : 0;

      const totalReturnCost = returnedOrders * returnCost;
      const finalCostPerOrder = dailyOrders > 0 ? (dailyAd / dailyOrders) : 0;
      const finalCostDZD = finalCostPerOrder * exchange;
      
      // Cost of Sold Goods = wholesale + ads + extra + (returnCost distributed)
      // Actually we sum total costs then divide or sum per unit
      const totalCost = wholesale + finalCostDZD + additionalCostsValue + (deliveredOrders > 0 ? (totalReturnCost / deliveredOrders) : 0);

      let calculatedFinalPrice = 0;
      let profitMargin = 0;

      if (isEditingPrice) {
        calculatedFinalPrice = parseFloat(document.getElementById("finalPrice").value) || 0;
        profitMargin = calculatedFinalPrice - totalCost;
        if(document.getElementById("profitMarginInput")) {
            // Avoid infinite loop by only setting if not focused or carefully
            // But here we just update display or value. 
            // Better to only update value if user is not typing in it
            if(document.activeElement.id !== "profitMarginInput") {
                document.getElementById("profitMarginInput").value = profitMargin > 0 ? profitMargin.toFixed(0) : 0;
            }
        }
      } else {
        // Default or margin editing
        profitMargin = parseFloat(document.getElementById("profitMarginInput").value) || 0;
        calculatedFinalPrice = totalCost + profitMargin;
        if(document.activeElement.id !== "finalPrice") {
             document.getElementById("finalPrice").value = calculatedFinalPrice > 0 ? calculatedFinalPrice.toFixed(0) : 0;
        }
      }

      const netProfit = profitMargin; // Per unit
      const dailyNetProfit = (netProfit * deliveredOrders) - totalReturnCost; // Wait, totalReturnCost is already in unit cost? 
      // Let's refine formula:
      // Unit Cost (Sold) = Wholesale + Ad(allocated) + Extra + Return(allocated)
      // Unit Profit = Price - Unit Cost
      // Daily Profit = Unit Profit * Delivered
      // This matches: (Price * Del) - (Unit Cost * Del)
      // Unit Cost * Del = (Whole*Del) + (Ad*Del/Orders? No Ad is fixed daily)
      
      // Let's stick to simple Daily P&L:
      // Revenue = Price * Delivered
      // Expenses = (Whole * Delivered) + (Ads Daily * Exch) + (Extra * Delivered) + (Return * Returned)
      // Profit = Revenue - Expenses
      
      // Re-calculate based on daily totals for accuracy
      const dailyRevenue = calculatedFinalPrice * deliveredOrders;
      const dailyWholesaleCost = wholesale * deliveredOrders; // Assuming we only pay wholesale for delivered? Usually confirm but let's assume COD model often only pays for what ships/delivers or maybe ships. 
      // If we buy stock upfront, it's different. Dropshipping model: pay when confirmed/shipped.
      // Let's assume we pay wholesale for every CONFIRMED order (shipped), then returned ones come back? 
      // Simple model: Cost of Goods Sold (COGS) for delivered items. Returned items go back to stock (minus return fees).
      
      const dailyTotalExpenses = (wholesale * deliveredOrders) + (dailyAd * exchange) + (additionalCostsValue * deliveredOrders) + (returnedOrders * returnCost);
      
      // Recalculate Unit metrics based on these daily totals to be consistent
      // Unit Profit = (Daily Revenue - Daily Expenses) / Delivered
      
      const realDailyProfit = dailyRevenue - dailyTotalExpenses;
      const realUnitProfit = deliveredOrders > 0 ? (realDailyProfit / deliveredOrders) : 0;
      
      // Update the variables used for display
      const roi = dailyTotalExpenses > 0 ? (realDailyProfit / dailyTotalExpenses) * 100 : 0;
      
      calculationResults = {
        wholesale, exchange, confirm, delivery, dailyAd, costPer, additionalCostsValue, returnCost,
        dailyOrders, confirmedOrders, deliveredOrders, returnedOrders, returnRate,
        totalReturnCost, finalCostPerOrder, finalCostDZD,
        totalCost: (dailyTotalExpenses / (deliveredOrders || 1)), // Approx unit cost
        calculatedFinalPrice, 
        profitMargin: realUnitProfit, 
        netProfit: realUnitProfit,
        dailyNetProfit: realDailyProfit, 
        revenue: dailyRevenue, 
        totalDailyCosts: dailyTotalExpenses, 
        roi
      };

      // ===== DISPLAY =====
      document.getElementById("dailyOrders").textContent = dailyOrders.toFixed(0);
      document.getElementById("confirmedOrders").textContent = confirmedOrders.toFixed(0);
      document.getElementById("deliveredOrders").textContent = deliveredOrders.toFixed(0);
      document.getElementById("returnedOrders").textContent = returnedOrders.toFixed(0);
      document.getElementById("returnRate").textContent = `${returnRate.toFixed(0)}%`;

      document.getElementById("costPerOrderDisplay").textContent = costPer.toFixed(2);
      document.getElementById("finalCostPerOrder").textContent = finalCostPerOrder.toFixed(2);
      document.getElementById("finalCostDZD").textContent = finalCostDZD.toFixed(0);

      document.getElementById("wholesalePriceDisplay").textContent = wholesale.toFixed(0);
      document.getElementById("adCostDisplay").textContent = finalCostDZD.toFixed(0);
      
      // Display Unit Cost approx
      const unitCostDisplay = deliveredOrders > 0 ? (dailyTotalExpenses / deliveredOrders) : 0;
      document.getElementById("totalCost").textContent = unitCostDisplay.toFixed(0);

      document.getElementById("finalPriceDisplay").textContent = calculatedFinalPrice.toFixed(0);
      document.getElementById("profitMarginDisplay").textContent = realUnitProfit.toFixed(0);
      document.getElementById("netProfitDisplay").textContent = realUnitProfit.toFixed(0);

      if (returnCost > 0 && returnedOrders > 0){
        document.getElementById("returnCostRow").classList.remove("hidden");
        document.getElementById("totalReturnCost").textContent = (returnedOrders * returnCost).toFixed(0);
        document.getElementById("dailyProfitCalc").textContent = `${dailyRevenue.toFixed(0)} - ${dailyTotalExpenses.toFixed(0)}`;
      } else {
        document.getElementById("returnCostRow").classList.add("hidden");
        document.getElementById("dailyProfitCalc").textContent = `${dailyRevenue.toFixed(0)} - ${dailyTotalExpenses.toFixed(0)}`;
      }

      document.getElementById("dailyNetProfit").textContent = realDailyProfit.toFixed(0);
      document.getElementById("revenue").textContent = dailyRevenue.toFixed(0);
      document.getElementById("totalDailyCosts").textContent = dailyTotalExpenses.toFixed(0);
      document.getElementById("roi").textContent = `${roi.toFixed(0)}%`;

      if (additionalCostsValue > 0){
        document.getElementById("additionalCostsRow").classList.remove("hidden");
        document.getElementById("additionalCostsDisplay").textContent = additionalCostsValue.toFixed(0);
      } else {
        document.getElementById("additionalCostsRow").classList.add("hidden");
      }

      const lossWarning = document.getElementById("lossWarning");
      if (realDailyProfit < 0) lossWarning.classList.remove("hidden");
      else lossWarning.classList.add("hidden");
    }

    function calculateMonthly(){
      if (!calculationResults.dailyNetProfit && calculationResults.dailyNetProfit !== 0) calculate();

      const monthlyRevenue = calculationResults.revenue * 30;
      const monthlyCosts = calculationResults.totalDailyCosts * 30;
      const monthlyProfit = calculationResults.dailyNetProfit * 30;
      const monthlyOrders = calculationResults.dailyOrders * 30;
      const monthlyDelivered = calculationResults.deliveredOrders * 30;
      const monthlyReturned = calculationResults.returnedOrders * 30;
      const monthlyReturnCostTotal = (calculationResults.returnedOrders * parseFloat(document.getElementById("returnCost").value || 0)) * 30;
      const monthlyROI = calculationResults.roi;

      document.getElementById("monthlyRevenue").textContent = monthlyRevenue.toLocaleString();
      document.getElementById("monthlyCosts").textContent = monthlyCosts.toLocaleString();
      document.getElementById("monthlyProfit").textContent = monthlyProfit.toLocaleString();

      document.getElementById("monthlyOrders").textContent = monthlyOrders.toFixed(0);
      document.getElementById("monthlyDelivered").textContent = monthlyDelivered.toFixed(0);
      document.getElementById("monthlyReturned").textContent = monthlyReturned.toFixed(0);
      document.getElementById("monthlyReturnCost").textContent = monthlyReturnCostTotal.toLocaleString();
      document.getElementById("monthlyROI").textContent = `${monthlyROI.toFixed(1)}%`;

      // Insights
      const insightsDiv = document.getElementById("monthlyInsights");
      insightsDiv.innerHTML = "";
      
      const addInsight = (text, colorClass) => {
        const div = document.createElement("div");
        div.className = `p-3 rounded-lg border ${colorClass} bg-opacity-10 flex items-center gap-2`;
        div.innerHTML = text;
        insightsDiv.appendChild(div);
      };

      if(monthlyProfit > 1000000) addInsight("ğŸš€ " + t("insight_profit_high"), "border-emerald-500 bg-emerald-500 text-emerald-200");
      else if(monthlyProfit > 200000) addInsight("âœ… " + t("insight_profit_mid"), "border-blue-500 bg-blue-500 text-blue-200");
      else if(monthlyProfit > 0) addInsight("âš ï¸ " + t("insight_profit_low"), "border-orange-500 bg-orange-500 text-orange-200");
      else addInsight("ğŸ›‘ " + t("insight_profit_neg"), "border-red-500 bg-red-500 text-red-200");

      if(monthlyROI > 200) addInsight("ğŸ”¥ " + t("insight_roi_high", {roi: monthlyROI.toFixed(0)}), "border-emerald-500 bg-emerald-500 text-emerald-200");
      else if(monthlyROI > 50) addInsight("ğŸ“ˆ " + t("insight_roi_mid", {roi: monthlyROI.toFixed(0)}), "border-blue-500 bg-blue-500 text-blue-200");
      else addInsight("ğŸ“‰ " + t("insight_roi_low", {roi: monthlyROI.toFixed(0)}), "border-red-500 bg-red-500 text-red-200");

      if(calculationResults.returnRate > 30) addInsight("ğŸ“¦ " + t("insight_ret_high", {rr: calculationResults.returnRate.toFixed(0)}), "border-red-500 bg-red-500 text-red-200");
    }

    function calculateDiscount() {
      const discount = parseInt(document.getElementById("discountSlider").value);
      document.getElementById("discountPercent").textContent = discount;

      const basePrice = calculationResults.calculatedFinalPrice || 0;
      const baseProfit = calculationResults.netProfit || 0;
      
      const discountedPrice = basePrice * (1 - (discount / 100));
      const discountedProfit = baseProfit - (basePrice - discountedPrice);

      document.getElementById("discountedPrice").textContent = discountedPrice.toFixed(0);
      document.getElementById("discountedProfit").textContent = discountedProfit.toFixed(0);

      // Table
      const table = document.getElementById("discountTable");
      table.innerHTML = "";
      
      [5, 10, 15, 20, 25, 30].forEach(d => {
        const p = basePrice * (1 - (d / 100));
        const prof = baseProfit - (basePrice - p);
        const row = document.createElement("div");
        row.className = "flex justify-between p-3 glass rounded-lg items-center";
        row.innerHTML = `
          <div class="font-bold text-white">-${d}%</div>
          <div class="text-white/80">${p.toFixed(0)} ${t("cur_dzd")}</div>
          <div class="font-bold ${prof > 0 ? 'text-emerald-300' : 'text-red-300'}">${prof.toFixed(0)} ${t("cur_dzd")}</div>
        `;
        table.appendChild(row);
      });
    }

    // Charts
    let costPieChart, profitBarChart, monthlyLineChart, ordersDonutChart, roiChart;

    function updateCharts() {
      if(!calculationResults.revenue) return;
      
      const r = calculationResults;
      const ctx1 = document.getElementById('costPieChart');
      const ctx2 = document.getElementById('profitBarChart');
      const ctx3 = document.getElementById('monthlyLineChart');
      const ctx4 = document.getElementById('ordersDonutChart');
      const ctx5 = document.getElementById('roiChart');

      if(costPieChart) costPieChart.destroy();
      if(profitBarChart) profitBarChart.destroy();
      if(monthlyLineChart) monthlyLineChart.destroy();
      if(ordersDonutChart) ordersDonutChart.destroy();
      if(roiChart) roiChart.destroy();

      Chart.defaults.color = 'rgba(255,255,255,0.7)';
      Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';

      // 1. Cost Breakdown
      // Wholesale total, Ads total, Extra total, Return total
      const totalWholesale = r.wholesale * r.deliveredOrders; // Approx
      const totalAds = r.dailyAd * r.exchange;
      const totalExtra = r.additionalCostsValue * r.deliveredOrders;
      const totalReturn = r.returnedOrders * r.returnCost;
      
      costPieChart = new Chart(ctx1, {
        type: 'doughnut',
        data: {
          labels: [t('wholesaleLine'), t('adsLine'), t('extraLine'), t('returnedOrders')],
          datasets: [{
            data: [totalWholesale, totalAds, totalExtra, totalReturn],
            backgroundColor: ['#8b5cf6', '#22d3ee', '#f59e0b', '#ef4444'],
            borderWidth: 0
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
      });

      // 2. Profit vs Revenue
      profitBarChart = new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: [t('revenue'), t('totalCost'), t('netProfit')],
          datasets: [{
            label: 'Daily Values',
            data: [r.revenue, r.totalDailyCosts, r.dailyNetProfit],
            backgroundColor: ['#10b981', '#ef4444', '#8b5cf6'],
            borderRadius: 8
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
      });

      // 3. Monthly Projection Line
      const days = Array.from({length: 30}, (_, i) => i + 1);
      const profitData = days.map(d => r.dailyNetProfit * d);
      
      monthlyLineChart = new Chart(ctx3, {
        type: 'line',
        data: {
          labels: days,
          datasets: [{
            label: t('monthlyProfit'),
            data: profitData,
            borderColor: '#22d3ee',
            backgroundColor: 'rgba(34,211,238,0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });

      // 4. Orders Donut
      ordersDonutChart = new Chart(ctx4, {
        type: 'doughnut',
        data: {
          labels: [t('deliveredOrders'), t('returnedOrders')],
          datasets: [{
            data: [r.deliveredOrders, r.returnedOrders],
            backgroundColor: ['#10b981', '#ef4444'],
            borderWidth: 0
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
      });

      // 5. ROI Gauge (Doughnut trick)
      // ROI can be 0 to >100. Let's show it as a single value or simple bar
      // Let's do a bar for simplicity or a gauge
      roiChart = new Chart(ctx5, {
        type: 'bar',
        data: {
          labels: ['ROI %'],
          datasets: [{
            data: [r.roi],
            backgroundColor: r.roi > 0 ? '#10b981' : '#ef4444',
            borderRadius: 10,
            barThickness: 40
          }]
        },
        options: { 
            indexAxis: 'y', 
            responsive: true, 
            maintainAspectRatio: false, 
            plugins: { legend: { display: false } },
            scales: { x: { min: 0 } }
        }
      });
    }

    function showSuccessMessage(message, type = "success"){
      const messageDiv = document.getElementById("successMessage");
      const messageText = document.getElementById("successText");
      if (!messageDiv || !messageText) return;

      messageText.textContent = message;
      messageDiv.classList.remove("hidden");

      setTimeout(() => {
        messageDiv.classList.add("hidden");
      }, 3000);
    }

    function hideSuccessMessage(){
      document.getElementById("successMessage")?.classList.add("hidden");
    }

    function saveData(){
      const data = {
        productName: document.getElementById("productName")?.value || "",
        wholesalePrice: document.getElementById("wholesalePrice")?.value || "",
        exchangeRate: document.getElementById("exchangeRate")?.value || "",
        confirmRate: document.getElementById("confirmRate")?.value || "",
        deliveryRate: document.getElementById("deliveryRate")?.value || "",
        dailyAdSpend: document.getElementById("dailyAdSpend")?.value || "",
        costPerOrder: document.getElementById("costPerOrder")?.value || "",
        additionalCosts: document.getElementById("additionalCosts")?.value || "",
        returnCost: document.getElementById("returnCost")?.value || "",
        finalPrice: document.getElementById("finalPrice")?.value || "",
        profitMarginInput: document.getElementById("profitMarginInput")?.value || "",
        lang: currentLang,
        currency: currentCurrency,
        timestamp: new Date().toISOString()
      };

      localStorage.setItem("pricingToolData", JSON.stringify(data));
      showSuccessMessage(t("msg_saved"), "success");
    }

    function loadData(){
      const saved = localStorage.getItem("pricingToolData");
      if (!saved){
        showSuccessMessage(t("msg_no_saved"), "warning");
        return;
      }

      const data = JSON.parse(saved);

      if (document.getElementById("productName")) document.getElementById("productName").value = data.productName ?? "";
      if (document.getElementById("wholesalePrice")) document.getElementById("wholesalePrice").value = data.wholesalePrice ?? "";
      if (document.getElementById("exchangeRate")) document.getElementById("exchangeRate").value = data.exchangeRate ?? (fxRates[currentCurrency] ?? fxRates.DZD);
      if (document.getElementById("confirmRate")) document.getElementById("confirmRate").value = data.confirmRate ?? "";
      if (document.getElementById("deliveryRate")) document.getElementById("deliveryRate").value = data.deliveryRate ?? "";
      if (document.getElementById("dailyAdSpend")) document.getElementById("dailyAdSpend").value = data.dailyAdSpend ?? "";
      if (document.getElementById("costPerOrder")) document.getElementById("costPerOrder").value = data.costPerOrder ?? "";
      if (document.getElementById("additionalCosts")) document.getElementById("additionalCosts").value = data.additionalCosts ?? "";
      if (document.getElementById("returnCost")) document.getElementById("returnCost").value = data.returnCost ?? "";
      if (document.getElementById("finalPrice")) document.getElementById("finalPrice").value = data.finalPrice ?? "";
      if (document.getElementById("profitMarginInput")) document.getElementById("profitMarginInput").value = data.profitMarginInput ?? "";

      if (data.currency) currentCurrency = data.currency;
      if (data.lang) currentLang = data.lang;

      setActiveByData("[data-lang]", "lang", currentLang);
      setActiveByData("[data-currency]", "currency", currentCurrency);

      applyTranslations();
      changeCurrency(currentCurrency);
      changeLanguage(currentLang);

      calculate();
      calculateMonthly();
      calculateDiscount();

      showSuccessMessage(t("msg_loaded"), "success");
    }

    function resetAll(){
      if (!confirm(t("confirm_reset"))) return;

      const ids = [
        "productName","wholesalePrice","exchangeRate","confirmRate","deliveryRate",
        "dailyAdSpend","costPerOrder","additionalCosts","returnCost","finalPrice","profitMarginInput"
      ];
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = "";
      });

      isEditingPrice = false;
      isEditingMargin = false;

      const ex = document.getElementById("exchangeRate");
      if (ex) ex.value = getStoredFx(currentCurrency) ?? (fxRates[currentCurrency] ?? fxRates.DZD);

      calculate();
      calculateMonthly();
      calculateDiscount();
      if (document.getElementById("tab-charts")?.classList.contains("active")) updateCharts();

      showSuccessMessage(t("msg_reset"), "success");
    }

    function loadExample(){
      if (document.getElementById("productName")) document.getElementById("productName").value = "Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ";
      if (document.getElementById("wholesalePrice")) document.getElementById("wholesalePrice").value = 1200;
      if (document.getElementById("exchangeRate")) document.getElementById("exchangeRate").value = (fxRates[currentCurrency] ?? fxRates.DZD);
      if (document.getElementById("confirmRate")) document.getElementById("confirmRate").value = 60;
      if (document.getElementById("deliveryRate")) document.getElementById("deliveryRate").value = 80;
      if (document.getElementById("dailyAdSpend")) document.getElementById("dailyAdSpend").value = 25;
      if (document.getElementById("costPerOrder")) document.getElementById("costPerOrder").value = 2.5;
      if (document.getElementById("additionalCosts")) document.getElementById("additionalCosts").value = 200;
      if (document.getElementById("returnCost")) document.getElementById("returnCost").value = 300;

      if (document.getElementById("profitMarginInput")) document.getElementById("profitMarginInput").value = 800;
      isEditingMargin = true;
      isEditingPrice = false;

      calculate();
      calculateMonthly();
      calculateDiscount();

      showSuccessMessage(t("msg_example"), "success");
    }

    async function exportToPDF(){
      try{
        showSuccessMessage(t("msg_pdf_generating"), "info");

        const { jsPDF } = window.jspdf || {};
        if (!jsPDF || !window.html2canvas){
          showSuccessMessage(t("msg_pdf_error"), "danger");
          return;
        }

        const node = document.querySelector(".content") || document.body;
        const canvas = await html2canvas(node, { scale: 2, backgroundColor: "#ffffff" });
        const imgData = canvas.toDataURL("image/png");

        const pdf = new jsPDF("p", "mm", "a4");
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const imgWidth = pageWidth;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        let y = 0;
        pdf.addImage(imgData, "PNG", 0, y, imgWidth, imgHeight);

        let heightLeft = imgHeight - pageHeight;
        while (heightLeft > 0){
          y -= pageHeight;
          pdf.addPage();
          pdf.addImage(imgData, "PNG", 0, y, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }

        pdf.save("COD-Pricing-Plan.pdf");
        showSuccessMessage(t("msg_pdf_done"), "success");

      } catch(err){
        console.error(err);
        showSuccessMessage(t("msg_pdf_error"), "danger");
      }
    }
  </script>
</body>
</html>
